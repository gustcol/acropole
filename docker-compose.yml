version: '3.8'

services:
  # Metadata Service (uses embedded sled database)
  metadata-service:
    build:
      context: .
      dockerfile: metadata-service/Dockerfile
    environment:
      RUST_LOG: info
    ports:
      - "8080:8080"
    networks:
      - integrity_network
    volumes:
      - metadata_db:/var/lib/acropole/metadata-db

  # Dashboard
  dashboard:
    build:
      context: ./dashboard
      dockerfile: Dockerfile
    ports:
      - "3000:80"
    depends_on:
      - metadata-service
    networks:
      - integrity_network
    environment:
      - REACT_APP_API_URL=http://localhost:8080

networks:
  integrity_network:
    driver: bridge

volumes:
  metadata_db:
